{% extends 'blog/base.html' %}

{% block content %}
    <div class="post">
        {% if post.published_date %}
            <div class="date">
                {{ post.published_date }}
            </div>
        {% endif %}
        {% if user.is_authenticated %}
            <a class="btn btn-default" href="{{ post.get_absolute_url }}edit/">
              <span class="glyphicon glyphicon-pencil"> Edit post</span>
            </a>
        {% endif %}
        {% if user.is_authenticated %}
        <h2>{{ post.title }}</h2>
        <p>{{ post.text|linebreaksbr }}</p>

        <p>
            <a href="{% url "blog:post_share" post.id %}">Share this post via e-mail</a>
        </p>

        <p>
            {% with comments.count as total_comments %}
                <h2>
                    {{ total_comments }} comment{{ total_comments|pluralize }}
                </h2>
            {% endwith %}
        </p>

        <p>
            {% for comment in comments %}
                <div class="comment">
                    <p class="info">
                        Comment {{ forloop.counter }} by {{ comment.name }}
                        {{ comment.created }}
                    </p>
                {{ comment.body|linebreaks }}
                </div>
                {% empty %}
                    <p>There are no comments yet.</p>
            {% endfor %}
        </p>

        <p>
            {% if new_comment %}
                <h2>Your comment has been added.</h2>
            {% else %}
                <h2>Add a new comment</h2>
                <form action="." method="post">
                    {{ comment_form.as_p }}
                    {% csrf_token %}
                    <p><input type="submit" value="Add comment"></p>
                </form>
            {% endif %}
        </p>

        {% endif %}
    </div>
{% endblock %}
